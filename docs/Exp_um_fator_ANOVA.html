<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>PLANEJAMENTO DE EXPERIMENTOS I STA13827</title>
    <meta charset="utf-8" />
    <meta name="author" content="Nátaly A. Jiménez Monroy" />
    <script src="libs/header-attrs/header-attrs.js"></script>
    <script src="libs/htmlwidgets/htmlwidgets.js"></script>
    <script src="libs/jquery/jquery.min.js"></script>
    <link href="libs/datatables-css/datatables-crosstalk.css" rel="stylesheet" />
    <script src="libs/datatables-binding/datatables.js"></script>
    <link href="libs/dt-core/css/jquery.dataTables.min.css" rel="stylesheet" />
    <link href="libs/dt-core/css/jquery.dataTables.extra.css" rel="stylesheet" />
    <script src="libs/dt-core/js/jquery.dataTables.min.js"></script>
    <script src="libs/jszip/jszip.min.js"></script>
    <script src="libs/pdfmake/pdfmake.js"></script>
    <script src="libs/pdfmake/vfs_fonts.js"></script>
    <link href="libs/dt-ext-buttons/css/buttons.dataTables.min.css" rel="stylesheet" />
    <script src="libs/dt-ext-buttons/js/dataTables.buttons.min.js"></script>
    <script src="libs/dt-ext-buttons/js/buttons.flash.min.js"></script>
    <script src="libs/dt-ext-buttons/js/buttons.html5.min.js"></script>
    <script src="libs/dt-ext-buttons/js/buttons.colVis.min.js"></script>
    <script src="libs/dt-ext-buttons/js/buttons.print.min.js"></script>
    <link href="libs/crosstalk/css/crosstalk.css" rel="stylesheet" />
    <script src="libs/crosstalk/js/crosstalk.min.js"></script>
    <script src="libs/plotly-binding/plotly.js"></script>
    <script src="libs/typedarray/typedarray.min.js"></script>
    <link href="libs/plotly-htmlwidgets-css/plotly-htmlwidgets.css" rel="stylesheet" />
    <script src="libs/plotly-main/plotly-latest.min.js"></script>
    <script src="libs/kePrint/kePrint.js"></script>
    <link href="libs/lightable/lightable.css" rel="stylesheet" />
    <link rel="stylesheet" href="xaringan-themer.css" type="text/css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.7.0/animate.min.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# PLANEJAMENTO DE EXPERIMENTOS I STA13827
## Experimentos com um Fator - ANOVA
### Nátaly A. Jiménez Monroy
### LECON/DEST - UFES
### Vitória. ES - 30/11/2021

---

[//]: &lt;&gt; (https://pkg.garrickadenbuie.com/extra-awesome-xaringan/intro/index.html#1)
[//]: &lt;&gt; (https://pkg.garrickadenbuie.com/xaringanthemer/articles/xaringanthemer.html)
[//]: &lt;&gt; (https://www.biostatistics.dk/talks/CopenhagenRuseRs-2019/index.html#1)
[//]: &lt;&gt; (https://rstudio-education.github.io/sharing-short-notice/#1)
[//]: &lt;&gt; (https://www.kirenz.com/slides/xaringan-demo-slides.html#1)
[//]: &lt;&gt; (https://github.com/yihui/xaringan/issues/26)
[//]: &lt;&gt; (https://github.com/emitanaka/anicon)
[//]: &lt;&gt; (https://github.com/mitchelloharawild/icons)
[//]: &lt;&gt; (https://slides.yihui.org/2020-genentech-rmarkdown.html#1)
[//]: &lt;&gt; (https://github.com/gadenbuie/xaringanExtra)
[//]: &lt;&gt; (class: center, middle, animated, slideInRight)

class: animated, slideInRight



&lt;style&gt; body {text-align: justify} &lt;/style&gt; &lt;!-- Justify text. --&gt;

# Análise de variância (ANOVA) - I

A análise de variância consiste em decompor a variação total das observações do experimento em partes que podem ser atribuídas a causas conhecidas (tratamentos, blocos, etc) e em partes atribuídas a causas não controladas e/ou não controláveis (erro experimental ou resíduo).
  
  
Em resumo:

$$
\text{Variação Total}=\textrm{Variação Controlada}+\textrm{Variação não Controlada}.
$$

---
[//]: &lt;&gt; (class: center, middle, animated, slideInRight/ class: animated slideInRight fadeOutLeft)
class: animated, fadeIn

## # Análise de variância (ANOVA) - II

Assume-se que há `\(a\)` tratamentos ou diferentes níveis de um único fator a serem comparados.

 | Tratamento (Níveis)  |                          Observações          |  Total          |         Média         |
 |:--------------------:|:---------------------------------------------:|:---------------:|:---------------------:| 
 |          1           |  `\(y_{11}\quad y_{12}\quad \cdots\quad y_{1n}\)` |  `\(y_{1\cdot}\)`   |     `\(\bar{y}_{1\cdot}\)`|
 |          2           |  `\(y_{21}\quad y_{22}\quad \cdots\quad y_{2n}\)` |  `\(y_{2\cdot}\)`   |     `\(\bar{y}_{2\cdot}\)`|
 |          `\(\vdots\)`    | `\(\vdots\qquad \vdots\qquad \cdots\qquad \vdots\)`|      `\(\vdots\)`  |               `\(\vdots\)`|
 |          `\(a\)`         |  `\(y_{a1}\quad y_{a2}\quad \cdots\quad y_{an}\)` |  `\(y_{a\cdot}\)`   |     `\(\bar{y}_{a\cdot}\)`|
 |            Total     |                                               | `\(y_{\cdot\cdot}\)`| `\(\bar{y}_{\cdot\cdot}\)`|
 
 -- 
 
  * `\(y_{ij}\)` representa a `\(j-\)`ésima observação do nível ou do tratamento `\(i\)`.
 
  * &lt;div class="math"&gt;
  \begin{align*}
y_{i\cdot}=\sum_{j=1}^n y_{ij},\quad \bar{y}_{i\cdot}=\sum_{j=1}^n \frac{y_{ij}}{n},\quad \bar{y}_{\cdot\cdot}=\sum_{i=1}^a\sum_{j=1}^n \frac{y_{ij}}{an}.
\end{align*}
 &lt;/div&gt;
 
---
[//]: &lt;&gt; (class: center, middle, animated, slideInRight/ class: animated slideInRight fadeOutLeft)
class: animated, fadeIn

# Exemplo - I

Considere um experimento cujo objetivo é verificar se a inclusão de raízes e tubérculos, como suplementação de inverno na alimentação de vacas em lactação, aumenta a produção de leite. Consideram-se 24 animais, três tipos de suplementos e uma testemunha (placebo), que são:

--

 - Sem suplemento (S)
 - Mandioca (M)
 - Araruta (A)
 - Batata doce (B).
 
--

Para definir o tipo de suplemento que será dado a cada animal, realiza-se um sorteio aleatório enumerando cada um dos 24 animais (parcelas) que participarão do estudo ( `\(1\)` a `\(24\)` ) e, em seguida, colocam-se os
tratamentos em uma sequência, como a dado a seguir:

--

`$$S_1\,\, S_2\,\, S_3\,\, S_4\,\, S_5\,\, S_6\qquad M_1\,\, M_2\,\,M_3\,\, M_4\,\, M_5\,\, M_6$$` 
`$$A_1\,\, A_2\,\, A_3\,\, A_4\,\, A_5\,\, A_6\qquad B_1\,\, B_2\,\, B_3\,\, B_4\,\, B_5\,\, B_6$$`
---
class: animated, fadeIn

# Exemplo - II

Utilizando um gerador de números aleatórios, aloca-se o animal a cada tipo de suplemento. Suponha que a sequência de números aleatórios sorteada, tenha sido
$$
  24\, 23\, 22\, 14\, 1\, 13\quad 6\, 20\, 8\, 7\, 9\, 4\quad 21\, 15\, 17\, 16\, 19\, 2\quad 11\, 5\, 10\, 3\, 18\, 12.
$$
Assim, tem-se a configuração do experimento:

| Vaca  | Tratamento ||  Vaca|  Tratamento || Vaca | Tratamento || Vaca| Tratamento |
|:-----:|:----------:||:----:|:-----------:||:----:|:----------:||:---:|:----------:|
|  1    | `\(S_5\)`      ||  7   | `\(M_4\)`       ||   13 |      `\(S_6\)` || 19  | `\(A_5\)`      |
|  2    | `\(A_6\)`      ||  8   | `\(M_3\)`       || 14   | `\(S_4\)`      || 20  | `\(M_2\)`      |
|  3    | `\(B_4\)`      || 9    | `\(M_5\)`       || 15   | `\(A_2\)`      || 21  | `\(A_1\)`      |
|  4    | `\(M_6\)`      || 10   | `\(B_3\)`       || 16   | `\(A_4\)`      || 22  | `\(S_3\)`      |
|  5    | `\(B_2\)`      || 11   | `\(B_1\)`       || 17   | `\(A_3\)`      || 23  | `\(S_2\)`      |
|  6    | `\(M_1\)`      || 12   | `\(B_6\)`       || 18   | `\(B_5\)`      || 24  | `\(S_1\)`      |

---
class: animated, fadeIn

# Exemplo - III

Considerem-se as seguintes produções médias diárias (kg) de leite a 4% de gordura das vacas
submetidas a administração de raízes e tubérculos, como suplementação de inverno na alimentação
de vacas em lactação.


|Id. | Prod.    || Id.   | Prod.     ||  Id.    | Prod.   || Id.   | Prod.|
|:--:|:--------:||:-----:|:---------:||:-------:|:-------:||:-----:|:----:|
|  1 | 22,81    ||  7    | 25,12     || 13      | 23,54   || 19    | 35,04|
|  2 | 35,19    ||  8    | 24,36     || 14      | 25,42   || 20    | 22,37|
|  3 | 20,37    ||  9    | 22,94     || 15      | 32,47   || 21    | 35,42|
|  4 | 24,80    || 10    | 26,54     || 16      | 34,48   || 22    | 23,43|
|  5 | 24,37    || 11    | 22,15     || 17      | 33,79   || 23    | 21,07|
|  6 | 23,40    || 12    | 24,06     || 18      | 19,54   || 24    | 19,58|


---
#Exemplo - IV


<div id="htmlwidget-2b8f3599a3f76feb69e0" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-2b8f3599a3f76feb69e0">{"x":{"filter":"none","extensions":["Buttons"],"data":[[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24],["S","A","B","M","B","M","M","M","M","B","B","B","S","S","A","A","A","B","A","M","A","S","S","S"],[22.81,35.19,20.37,21.56,24.37,23.4,25.12,24.36,22.94,26.54,22.15,24.06,23.54,25.42,32.47,34.48,33.79,19.54,35.04,22.37,35.42,23.43,21.07,19.58]],"container":"<table class=\"compact\">\n  <thead>\n    <tr>\n      <th>Animal<\/th>\n      <th>Suplemento<\/th>\n      <th>Producao<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"dom":"tBp","buttons":[{"extend":"csv","filename":"suplementos"},{"extend":"excel","filename":"suplementos"},{"extend":"pdf","filename":"suplementos"}],"pageLength":12,"columnDefs":[{"className":"dt-right","targets":[0,2]}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[10,12,25,50,100]}},"evals":[],"jsHooks":[]}</script>
 

---
class: animated, fadeIn

# Exemplo - V

Seja `\(y_{ij}\)` o valor da produção de leite da `\(j-\)`ésima vaca que recebeu o `\(i-\)`ésimo tratamento. Os
valores das produções (kg) de leite a 4% de gordura das vacas que participaram do estudo podem ser resumidos na forma:

| Tratamento|   Observações   |  Média |
|:---------:|:---------------:|:------:|
|     S     | `\(19,58  \quad 21,07  \quad  23,43  \quad  25,42 \quad 22,81 \quad 23,54\)` | 22,64|
|     M     | `\(23,40  \quad 22,37  \quad  24,36  \quad  25,12 \quad 22,94 \quad 21,56\)` | 23,29|
|     A	    | `\(35,42  \quad 32,47  \quad  34,48  \quad  33,79 \quad 35,04 \quad 35,19\)` | 34,39|
|     B     | `\(22,15  \quad 24,37  \quad 26,54   \quad 20,37  \quad 19,54 \quad 24,06\)` | 22,83|

--

&gt;**Objetivo**: Testar se há diferença na produção média de leite de acordo com o tipo de suplementação.

---
class: animated, fadeIn

# Exemplo - VI

&lt;div align = 'center'&gt;
<div id="htmlwidget-1c9e140e75cf83e63dd6" style="width:504px;height:504px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-1c9e140e75cf83e63dd6">{"x":{"visdat":{"46191c9b2c87":["function () ","plotlyVisDat"]},"cur_data":"46191c9b2c87","attrs":{"46191c9b2c87":{"x":{},"y":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"box"}},"layout":{"margin":{"b":80,"l":60,"t":80,"r":50,"pad":4},"xaxis":{"domain":[0,1],"automargin":true,"range":["S","M","A","B"],"title":"Tipo de Suplemento","type":"category","categoryorder":"array","categoryarray":["A","B","M","S"]},"autosize":true,"showlegend":false,"yaxis":{"domain":[0,1],"automargin":true,"title":"Producao"},"hovermode":"closest"},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"fillcolor":"rgba(31,119,180,0.5)","x":["S","A","B","M","B","M","M","M","M","B","B","B","S","S","A","A","A","B","A","M","A","S","S","S"],"y":[22.81,35.19,20.37,21.56,24.37,23.4,25.12,24.36,22.94,26.54,22.15,24.06,23.54,25.42,32.47,34.48,33.79,19.54,35.04,22.37,35.42,23.43,21.07,19.58],"type":"box","marker":{"color":"rgba(31,119,180,1)","line":{"color":"rgba(31,119,180,1)"}},"line":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
&lt;/div&gt;

---
class: animated, fadeIn

# Exemplo - VII

Medidas descritivas:



```r
datasummary(Producao~Suplemento*(Mean + SD), data=dados)
```

&lt;table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;"&gt;
 &lt;thead&gt;
&lt;tr&gt;
&lt;th style="empty-cells: hide;border-bottom:hidden;" colspan="1"&gt;&lt;/th&gt;
&lt;th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="2"&gt;&lt;div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; "&gt;A&lt;/div&gt;&lt;/th&gt;
&lt;th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="2"&gt;&lt;div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; "&gt;B&lt;/div&gt;&lt;/th&gt;
&lt;th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="2"&gt;&lt;div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; "&gt;M&lt;/div&gt;&lt;/th&gt;
&lt;th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="2"&gt;&lt;div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; "&gt;S&lt;/div&gt;&lt;/th&gt;
&lt;/tr&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt;   &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Mean &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; SD &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Mean  &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; SD  &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Mean   &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; SD   &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Mean    &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; SD    &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Producao &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 34.40 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1.11 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 22.84 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2.65 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 23.29 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1.30 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 22.64 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2.05 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

---
class: animated, fadeIn

# Exemplo - VIII

**Análise**

Aplicar o teste `\(t\)` para amostras independentes e analisar todos os pares de médias.
  * Hipóteses:
  $$
  \textrm{H}_0: \mu_1-\mu_2=0\quad \textrm{vs. } \textrm{H}_1: \mu_1-\mu_2\neq 0.
  $$
  * Estatística de teste:
  $$
  t_{0}=\dfrac{(\bar{y}_1-\bar{y}_2)-(\mu_1-\mu_2)}{S_p\sqrt{\frac{1}{n_1}+\frac{1}{n_2}}},
  $$
  onde
  $$
  S_p^2=\sqrt{\frac{(n_1-1)s_1^2+(n_2-1)s_2^2}{n_1+n_2-2}}
  $$

---
class: animated, fadeIn

# Exemplo - IX

**Resultados**


```r
with(dados,pairwise.t.test(Producao, Suplemento, p.adjust.method = "none"))
```

```
## 
## 	Pairwise comparisons using t tests with pooled SD 
## 
## data:  Producao and Suplemento 
## 
##   A       B    M   
## B 1.1e-09 -    -   
## M 2.1e-09 0.68 -   
## S 8.1e-10 0.86 0.56
## 
## P value adjustment method: none
```

---
class: animated, fadeIn

# Exemplo - X

**Resumindo:**

 |     |  S   |  M    |   A   |    B  |
 |:---:|:----:|:-----:|:-----:|:-----:|
 | S   | --   | ND    | **    | ND    |
 | M   | --   | --    | **    | ND    | 
 | A   | --   | --    | --    | **    |
 | B   | --   | --    | --    | --    |

  &gt; ND: Sem diferença significativa. **: Diferença significativa ao nível `\(5\%\)`.

--

**Observação**: Esta solução é **&lt;span style="color:orange"&gt;INCORRETA&lt;/span&gt;**, pois leva a uma distorção do Erro Tipo I.

--

Suponha que seja testada a igualdade das quatro médias usando comparações pareadas. Há 6 pares possíveis e, se a probabilidade de aceitar corretamente a hipótese nula para cada par testado é de `\((1-\alpha)=0,95\)`, então a probabilidade de aceitar corretamente a hipótese nula para todos os 6 pares é `\((0,95)^6=0,7359\)`, se os testes forem independentes.

---
class: animated, slideInRight

#.

.center[
##Solução apropriada para testar 
##a igualdade de várias médias:
#**&lt;span style="color:orange"&gt;Análise de Variância&lt;/span&gt;**
]

---
class: animated, fadeIn

#Modelo estatístico

O modelo para descrever os dados de um experimento pode ser escrito como

`$$y_{ij}=\mu_i+\epsilon_{ij}, \quad i=1,\ldots,a,\quad j=1,\ldots,n,$$`
--

onde 

 * `\(y_{ij}\)` representa a `\(ij-\)`ésima observação
 * `\(\mu_i\)` é a média do `\(i-\)`ésimo nível do fator ou tratamento
 * `\(\epsilon_{ij}\)` é o erro aleatório, que incorpora todas as outras fontes de variabilidade no experimento (medição, fatores não controlados, diferenças entre unidades experimentais, ruídos, etc). Assume-se que `\(\textrm{E}(\epsilon_{ij})=0\)`, de modo que `\(\textrm{E}(y_{ij})=\mu_{i}\)`.
 

 &gt;**Observação**: O modelo anterior é chamado Modelo de médias.

---
class: animated, fadeIn

#Forma alternativa
Seja

`$$\mu_i=\mu+\tau_i,\qquad i=1,2,\ldots,a.$$`
--

A Equação do slide anterior torna-se o **Modelo de efeitos**, escrito como

`$$y_{ij}=\mu+\tau_i+\epsilon_{ij}, \qquad i=1,\ldots,a,\quad j=1,\ldots, n,$$`

--

onde
  * `\(y_{ij}\)` é o valor observado na unidade `\(j\)` que recebeu o tratamento `\(i\)`
  * `\(\mu\)` é um parâmetro constante, comum a todos os tratamentos, chamado média geral (quando os dados são balanceados)
  *  `\(\tau_i\)` é um parâmetro único que representa o efeito do `\(i-\)`ésimo tratamento
  * `\(\epsilon_{ij}\)` é um componente do erro aleatório, associado à `\(j-\)`ésima repetição do `\(i-\)`ésimo tratamento.


---
class: animated, bounceInDown
## Objetivo

  - Se os `\(a\)` tratamentos foram selecionados especificamente pelo experimentador, o interesse é testar hipóteses sobre as médias dos tratamentos e as conclusões aplicam apenas aos níveis do fator considerados na análise. Interessa também estimar os parâmetros do modelo `\((\mu, \tau_i,\sigma^2)\)` `\(\Longrightarrow\)` **&lt;span style="color:orange"&gt;Modelo de Efeitos Fixos&lt;/span&gt;**.
  
--

  - Se os `\(a\)` tratamentos foram selecionados como uma amostra aleatória de uma população maior de tratamentos, o interesse é estender  as conclusões a todos os tratamentos na população. Nesse caso, os `\(\tau_i\)` são variáveis aleatórias e os testes de hipóteses recaem sobre a variabilidade de `\(\tau_i\)` tentando-se estimar essa variabilidade `\(\Longrightarrow\)` **&lt;span style="color:orange"&gt;Modelo de Efeitos Aleatórios&lt;/span&gt;** ou **&lt;span style="color:orange"&gt;Modelo de Componentes de Variância&lt;/span&gt;**.


---
class: animated, bounceInDown
## Modelo de Efeitos Aleatórios - I

`$$y_{ij}=\mu+\tau_i+\epsilon_{ij},\quad i=1,\ldots,a,\quad j=1,\ldots,n,$$`
--

onde

  - `\(y_{ij}\)` é a observação do `\(i-\)`ésimo tratamento na `\(j-\)`ésima unidade experimental (variável resposta);
  
  - `\(\mu\)` é a média global;
  
  - `\(\tau_i\)` é o efeito do `\(i-\)`ésimo tratamento;
  
  - `\(\epsilon_{ij}\)` é o erro associado ao `\(i-\)`ésimo tratamento na `\(j-\)`ésima unidade experimental. Incorpora todas as fontes de variabilidade não controladas no experimento.
  
  - Tem-se que `\(\tau_i\)` e `\(\epsilon_{ij}\)` são variáveis aleatórias independentes entre si, com `\(\tau_i\sim N(0,\sigma_{\tau}^2)\)` e `\(\epsilon_{ij}\sim N(0,\sigma^2)\)`.
  
  
---
class: animated, fadeIn
## Modelo de Efeitos Aleatórios - II

  - A condição `\(E(\tau_i)=0\)` é similar à condição `\(\sum_{i=1}^a \tau_i=0\)`. Estabelece que o efeito esperado do `\(i-\)`ésimo nível como um desvio de `\(\mu\)` é zero.
  - Se a variância dos efeitos dos tratamentos `\(\tau_i\)` é `\(\sigma_{\tau}^2\)`, a variância da resposta é dada por
  
    `$$\text{var}(y_{ij})=\sigma_{\tau}^2+\sigma^2.$$`
    
    As variâncias `\(\sigma_{\tau}^2\)` e `\(\sigma^2\)` são chamadas **&lt;span style="color:orange"&gt;Componentes de variância&lt;/span&gt;**.
  - Nesse modelo, os efeitos têm interpretação diferente. As hipóteses testadas são:
  
&lt;div class="math"&gt;
\[\begin{cases}
 \text{H}_0:&amp; \sigma_{\tau}^2=0\\
 \text{H}_1:&amp; \sigma_{\tau}^2&gt;0.
 \end{cases}\]
&lt;/div&gt;

Se `\(\sigma_{\tau}^2=0\)`, todos os tratamentos são idênticos, mas se `\(\sigma_{\tau}&gt;0\)`, há variabilidade entre os tratamentos.

---
class: animated, fadeIn
## Exemplos

  * Para estudar o efeito de diferentes operadores sobre o tempo de execução de uma tarefa, em uma determinada máquina, seleciona-se uma amostra de cinco operadores de um grupo de `\(N\)` operadores possíveis.


  * Para estudar o efeito dos trilhos usados nas estradas de ferro, sobre o tempo de percurso de certo tipo de onda resultante da pressão longitudinal dos trilhos, selecionaram-se aleatoriamente seis trilhos e são feitas três medições.
  
  
---
class: animated, bounceInDown
## Modelo de Efeitos Fixos

`$$y_{ij}=\mu+\tau_i+\epsilon_{ij},\quad i=1,\ldots,a,\quad j=1,\ldots,n,$$`
--

onde

  - `\(y_{ij}\)` é a observação do `\(i-\)`ésimo tratamento na `\(j-\)`ésima unidade experimental (variável resposta);
  - `\(\mu\)` é a média geral, comum a todos os tratamentos;
  - `\(\tau_i\)` representa o efeito do `\(i-\)`ésimo tratamento;
  - `\(\epsilon_{ij}\)` é o erro associado ao `\(i-\)`ésimo tratamento na `\(j-\)`ésima unidade experimental. Incorpora todas as fontes de variabilidade não controladas no experimento.

---
class: animated, fadeIn
## Pressupostos da ANOVA

--
  * Os efeitos principais devem ser aditivos: Nos experimentos, cada observação segue um modelo linear aditivo `\(y_{ij}=\mu+\tau_i+\epsilon_{ij}\)`.
  
  * Os erros de observação são independentes:
`$$\text{cov}(\epsilon_{ij},\epsilon_{ij}')=0.$$`
  * Os erros são homoscedásticos: Cada tratamento deve ter aproximadamente a mesma variância.
  
  * Os erros são normalmente distribuídos: Para que a ANOVA seja válida, os erros devem ser originários da mesma população.

--
###Em resumo...
`$$\epsilon_{ij}\sim N(0,\sigma^2).$$`

---
class: animated, fadeIn
#Hipóteses

O objetivo é, em geral, verificar se existe diferença significativa entre pelo menos duas médias de tratamentos. As hipóteses testadas são:

&lt;div class="math"&gt;
\[\begin{align*}
\textrm{H}_0&amp;: \mu_1=\mu_2=\cdots=\mu_a\\
\textrm{H}_1&amp;: \mu_i\neq \mu_i' \quad \textrm{para pelo menos um } i\neq i'.
\end{align*}
\]
&lt;/div&gt;

--

###Forma equivalente:

&lt;div class="math"&gt;
\[\begin{align*}
\textrm{H}_0&amp;: \tau_1=\tau_2=\cdots=\tau_a=0\\
\textrm{H}_1&amp;: \tau_i\neq 0 \quad \textrm{para pelo menos um } i.
\end{align*}
\]
&lt;/div&gt;


---
class: animated, fadeIn
#Estimação dos Parâmetros - MQO I

###Funções de Parâmetros Completamente Estimáveis

Uma função dos parâmetros de qualquer modelo linear é dita **&lt;span style="color:orange"&gt;estimável&lt;/span&gt;** se, e somente se, pode ser escrita como o valor esperado de uma combinação linear das variáveis resposta. Apenas funções estimáveis dos parâmetros têm estimativas lineares não-viesadas únicas. Para o modelo de análise de variância de uma via, cada função estimável tem a forma
&lt;div class="math"&gt;
\[\begin{align*}
\mathbb{E}\left[\sum_{i=1}^a \sum_{j=1}^n a_{ij}y_{ij}\right]&amp;=\sum_{i=1}^a \sum_{j=1}^n a_{ij}\mathbb{E}[y_{ij}]\\
&amp;=\sum_{i=1}^a \sum_{j=1}^n a_{ij} (\mu + \tau_i)=\sum_{i=1}^a b_i(\mu + \tau_i),
\end{align*}
\]
&lt;/div&gt;

onde `\(b_i=\sum_{j=1}^n a_{ij}\)` e os `\(a_{ij}\)` são números reais. Qualquer função diferente dessa forma não será estimável.

--

&gt; **Observação**: Claramente `\(\mu+\tau_1\)` é estimável, pois pode ser obtida fixando `\(b_1=1\)` e `\(b_2=b_3=\cdots=b_a=0\)`.  Da mesma forma, cada `\(\mu+\tau_i\)` é estimável.

---
class: animated, fadeIn
#Estimação dos Parâmetros - MQO II

###Obtenção das Estimativas

`$$L(\mu,\tau_1,\ldots,\tau_a)=\sum_{i=1}^a\sum_{j=1}^n \epsilon_{ij}^2=\sum_{i=1}^a\sum_{j=1}^n (y_{ij}-\mu-\tau_i)^2$$`
--

Derivando-se `\(L\)` em relação a cada um dos parâmetros, tem-se

&lt;div class="math"&gt;
\[\begin{align*}
\frac{\partial L(\mu,\tau_1,\ldots,\tau_a)}{\partial\mu}&amp;=-2\sum_{i=1}^a\sum_{j=1}^n (y_{ij}-\mu-\tau_i)\\
\frac{\partial L(\mu,\tau_1,\ldots,\tau_a)}{\partial\tau_i}&amp;=-2\sum_{j=1}^n (y_{ij}-\mu-\tau_i)\\
\end{align*}
\]
&lt;/div&gt;

---
class: animated, fadeIn
#Estimação dos Parâmetros - MQO III

Igualando-se os resultados a zero, tem-se:
&lt;div class="math"&gt;
\[\begin{align*}
-2\sum_{i=1}^a\sum_{j=1}^n (y_{ij}-\hat{\mu}-\hat{\tau}_i)&amp;=0\\
-2\sum_{j=1}^n (y_{ij}-\hat{\mu}-\hat{\tau}_i)&amp;=0\\
\end{align*}
\]
&lt;/div&gt;

--

Aplicando os somatórios, obtem-se o sistema de equações normais:

&lt;div class="math"&gt;
\[\begin{align*}
\sum_{i=1}^a\sum_{j=1}^n y_{ij} &amp;=an\widehat{\mu}+n\sum_{i=1}^a \widehat{\tau}_i\\
\sum_{j=1}^n y_{ij}&amp;= n\widehat{\mu}+n\widehat{\tau}_i
\end{align*}
\]
&lt;/div&gt;

---
class: animated, fadeIn
#Estimação dos Parâmetros - MQO IV

&gt; **Problema**: O conjunto de equações normais não é linearmente independente. Não existe solução única para os parâmetros a serem estimados.

--

&gt;**Solução**: Impor a restrição:
 `$$\sum_{i=1}^a \hat\tau_i=0$$`
Nessas condições:
&lt;div class="math"&gt;
\[\begin{align*}
  \hat\mu&amp;=\overline{y}_{\cdot\cdot}\\
  \hat{\tau}_i&amp;=\overline{y}_{i\cdot}-\overline{y}_{\cdot\cdot}, \quad i=1,\ldots,a.
\end{align*}
\]
&lt;/div&gt;

---
class: animated, bounceInDown
#Decomposição das Somas de Quadrados - I

A variabilidade total dos dados pode ser reescrita em função das médias de cada tratamento, assim

&lt;div class="math"&gt;
\[\begin{align*}
\sum_{i=1}^a\sum_{j=1}^n (y_{ij}-\overline{y}_{\cdot\cdot})^2&amp;=\sum_{i=1}^a\sum_{j=1}^n (y_{ij}-\overline{y}_{i\cdot}+\overline{y}_{i\cdot}-\overline{y}_{\cdot\cdot})^2\\
&amp;=\sum_{i=1}^a\sum_{j=1}^n [(y_{ij}-\overline{y}_{i\cdot})^2+(\overline{y}_{i\cdot}-\overline{y}_{\cdot\cdot})^2+2(y_{i\cdot}-\overline{y}_{\cdot\cdot})(y_{ij}-\overline{y}_{i\cdot})]\\
&amp;=\sum_{i=1}^a\sum_{j=1}^n (y_{ij}-\overline{y}_{i\cdot})^2+\sum_{i=1}^a\sum_{j=1}^n (\overline{y}_{i\cdot}-\overline{y}_{\cdot\cdot})^2+2\sum_{i=1}^a\sum_{j=1}^n (y_{i\cdot}-\overline{y}_{\cdot\cdot})(y_{ij}-\overline{y}_{i\cdot})\\
\sum_{i=1}^a\sum_{j=1}^n (y_{ij}-\overline{y}_{\cdot\cdot})^2&amp;=\sum_{i=1}^a\sum_{j=1}^n (y_{ij}-\overline{y}_{i\cdot})^2+\sum_{i=1}^a\sum_{j=1}^n (\overline{y}_{i\cdot}-\overline{y}_{\cdot\cdot})^2,
\end{align*}
\]
&lt;/div&gt;

--

pois

`$$\sum_{i=1}^a\sum_{j=1}^n (y_{i\cdot}-\overline{y}_{\cdot\cdot})(y_{ij}-\overline{y}_{i\cdot})=0.$$`
---
class: animated, fadeIn
#Decomposição das Somas de Quadrados - II

Logo,

&lt;div class="math"&gt;
\[\begin{align*}
 \sum_{i=1}^a\sum_{j=1}^n (y_{ij}-\overline{y}_{\cdot\cdot})^2&amp;=\underbrace{\sum_{i=1}^a\sum_{j=1}^n (y_{ij}-\overline{y}_{i\cdot})^2}+\underbrace{\sum_{i=1}^a\sum_{j=1}^n (\overline{y}_{i\cdot}-\overline{y}_{\cdot\cdot})^2}\\
 SQT &amp;= \phantom{****}\,SQE\qquad\quad + \phantom{****}SQTr
\end{align*}
\]
&lt;/div&gt;

--

Desenvolvendo-se os quadrados, obtem-se

&lt;div class="math"&gt;
\[\begin{align*}
SQT&amp;=\sum_{i=1}^a\sum_{j=1}^n y_{ij}^2-\dfrac{y_{\cdot\cdot}^2}{an}\\
SQTr&amp;=\sum_{i=1}^a \dfrac{y_{i\cdot}^2}{n}-\dfrac{y_{\cdot\cdot}^2}{an}\\
SQE&amp;=SQT-SQTr
\end{align*}
\]
&lt;/div&gt;


---
class: animated, fadeIn
#Decomposição das Somas de Quadrados - III

**Observações**

  * Lembre-se que a variância é calculada como `\(\dfrac{SQ}{gl}\)`, onde `\(SQ\)` representa a soma de quadrados dos desvios com respeito à média e `\(gl\)` são os graus de liberdade.
  
  
  --
  
  
  * Na ANOVA têm-se quantidades semelhantes a variâncias, chamadas de &lt;span style="color:orange"&gt;**Quadrados Médios**&lt;/span&gt; (QM), calculados como
`$$QMTr=\dfrac{SQTr}{gl_{Tr}}\qquad   QME=\dfrac{SQE}{gl}$$`
Observe-se que não são exatamente médias porque o denominador não é `\(n\)`.

---
class: animated, fadeIn
#Decomposição das Somas de Quadrados - IV

**Observações - cont.**

  * Há `\(N=an\)` observações totais, logo `\(SQT\)` tem `\(N-1\)` graus de liberdade.
  
--

  * Há `\(a\)` tratamentos, logo `\(SQTr\)` tem `\(a-1\)` graus de liberdade.
  
--

  * Há `\(n\)` réplicas que proporcionam `\(n-1\)` graus de liberdade para estimar o erro experimental. Dado que há `\(a\)` tratamentos, SQE tem `\(a(n-1)\)` graus de liberdade (ou `\(N-a\)` gl).
  
--

Daí:
`$$QMTr=\dfrac{SQTr}{a-1}\qquad   QME=\dfrac{SQE}{N-a}.$$`

---
class: animated, bounceInDown
#Tabela de Análise de Variância - ANOVA

|Fonte de Variação     | g.l.    || SQ   || QM     ||  `\(F_0\)`    |
|:--------------------:|:-------:||:----:||:------:||:---------:|
|  Tratamentos (Entre) | `\(a-1\)`    ||  `$$SQTr=\frac{1}{n}\sum_{i=1}^a y_{i\cdot}^2-\frac{y_{\cdot\cdot}^2}{N}$$`    || `$$QMTr=\frac{SQTr}{a-1}$$`     || `$$\frac{QMTr}{QME}$$`      |
|  Erro (Dentro)       | `\(N-a\)`    ||  `$$SQE=SQT-SQTr$$`    || `$$QME=\frac{SQE}{N-a}$$`     ||       | 
|  Total               | `\(N-1\)`    ||  `$$SQT=\sum_{i=1}^a\sum_{j=1}^n y_{ij}^2-\frac{y_{\cdot\cdot}^2}{N}$$`    ||  || | 

---
class: animated, bounceInDown
#Exemplo - Continuação

|Fonte de Variação     | g.l.    || SQ     || QM     ||  `\(F_0\)`    |
|:-------------------- |:-------:||:------:||:------:||:---------:|
|  Tratamentos (Entre) | 3       || 593,82 || 197,93 || 56,03     |
|  Erro (Dentro)       | 20      || 70,65  || 3,53   ||           | 
|  Total               | 23      || 664,46||         ||           | 

--

**No R:**


```r
fit &lt;- aov(Producao ~ Suplemento, data = dados)

summary(fit)
```

```
##             Df Sum Sq Mean Sq F value  Pr(&gt;F)    
## Suplemento   3  593.8  197.94   56.03 6.5e-10 ***
## Residuals   20   70.7    3.53                    
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
```

---
class: animated, bounceInDown
#Verificação do Modelo

Os resíduos são dados por

`$$\hat{\epsilon}_{ij}=y_{ij}-\overline{y}_{i\cdot}$$`
--

Deve-se verificar:

  * Presença de dados discrepantes.
  
  * Independência dos resíduos.
  
  * Homoscedasticidade.
  
  * Distribuição Normal dos resíduos.


---
class: animated, fadeIn
#Verificação do Modelo - I

**Dados discrepantes**

Estimar os resíduos padronizados

`$$z_{ij}=\frac{\hat{\epsilon}_{ij}}{\sqrt{QME}}.$$`

Se a normalidade dos resíduos for satisfeita, aproximadamente 99,7% deles devem estar no intervalo `\((-3;3)\)`. Assim, resíduos fora desse intervalo, são considerados discrepantes.

--

**Independência**
  * Usa-se o gráfico dos resíduos padronizados versus a ordem de coleta dos dados.
  
  * Gráfico de resíduos versus valores preditos.
  
  * Pode-se aplicar o Teste de Durbin-Watson.

---
class: animated, fadeIn
#Verificação do Modelo - II

**Homoscendasticidade**
  * Análise gráfica, por exemplo box-plot ou gráfico de dispersão para tratamentos vs. resíduos.
  
  * Teste de Hartley (Precisa ter igual número de réplicas em cada tratamento).
  
  * Teste de Bartlett (Diferente número de repetições. Sensível à não normalidade dos dados).
  
  * Teste de Cochran (Pode ser usado com diferente número de repetições por tratamento).
  
  * Teste de Goldfeld-Quandt.
  
---
class: animated, fadeIn
#Verificação do Modelo - III

**Transformação de Box-Cox**

`$$y^*=\begin{cases}
     \frac{y^{\lambda}-1}{\lambda}&amp; \text{se }\lambda\neq 0\\
     \ln{y}                       &amp; \text{se }\lambda = 0.
    \end{cases}$$`
    



A utilização da transformação Box-Cox exige que todos os valores da sequência de entrada sejam positivos e diferentes de zero. Se a sequência de entrada não atende a esses requisitos, ela pode ser movida transformada para garantir os valores positivos.

--

Dependendo do valor de `\(\lambda\)`, a transformação de Box-Cox inclui os casos especiais:

&lt;div class="math"&gt;
\[\begin{align*}
\lambda&amp;=-1.0\quad y^*=\frac{1}{y}\\
\lambda&amp;=-0.5\quad y^*=\frac{1}{\sqrt{y}}\\
\lambda&amp;=-0.0\quad y^*=\ln{y}\\
\lambda&amp;=0.5\quad y^*=\sqrt{y}\\
\lambda&amp;=1.0\quad y^*=y^2\\
\end{align*}
\]
&lt;/div&gt;
    

---
class: animated, fadeIn
#Verificação do Modelo - IV

Para determinar o valor ideal do parâmetro `\(\lambda\)`, maximiza-se o logaritmo da função de verossimilhança
&lt;div class="math"&gt;
\[\begin{align*}
  f(y,\lambda)&amp;=-\frac{N}{2}\ln\left[\sum_{i=0}^{N-1}  \frac{(y(\lambda)-\bar{y}(\lambda))^2}{N} \right]+(\lambda-1)\sum_{i=1}^{N-1} \ln(y)\\
  \bar{y}(\lambda)&amp;=\frac{1}{N}\sum_{i=0}^{N-1} y(\lambda)
\end{align*}
\]
&lt;/div&gt;


-- 


Isto implica que precisamos selecionar o valor de `\(\lambda\)` em que esta função atinge seu valor máximo.

  * Alguns autores sugerem encontrar o valor ideal de `\(\lambda\)` com base na procura do maior valor do coeficiente de correlação entre os quantis da função de distribuição normal e a sequência transformada classificada.

  
---
class: animated, fadeIn
#Verificação do Modelo - V

**Normalidade** 
  * Histograma.
  
  * Gráfico quantil-quantil dos resíduos padronizados.
  
  * Testes de normalidade: Shapiro-Wilks, Anderson-Darling, Lilliefors, etc.

---
class: animated, fadeIn
#Verificação do Modelo - VI



```r
par(mfrow=c(2,2))
plot(fit)
```

&lt;img src="Exp_um_fator_ANOVA_files/figure-html/unnamed-chunk-6-1.png" width="40%" style="display: block; margin: auto;" /&gt;


---
class: animated, bounceInDown
#A hipótese nula foi rejeitada...e agora?

--

Precisamos determinar quais médias são diferentes.

  - Comparação duas a duas;
  
  - Comparação das médias dos tratamentos com a média do grupo controle;
  
  - Comparações múltiplas.


---
class: animated, fadeIn
#Contrastes

Um contraste é uma combinação linear de parâmetros da forma

`$$\Gamma=\sum_{i=1}^a c_i\mu_i \quad \text{ em que } \quad \sum_{i=1}^a c_i=0.$$`

--

  &gt;Lembrando da definição de função estimável, observamos que todos os contrastes são estimáveis na análise de variância a uma via. Por exemplo, fixando `\(b_1=1\)`, `\(b_2=-1\)`, `\(b_3,\ldots,b_a=0\)`, temos que `\(\mu_1-\mu_2\)` é uma função estimável. Da mesma forma, cada `\(\mu_i-\mu_k\)`, `\(i\neq k\)`, é estimável.  

--

**Exemplo:** No experimento da suplementação para vacas em lactação, poderia-se pensar que os suplementos 2 e 4 produzem a mesma quantidade de leite, implicando no teste das hipóteses
`$$\textrm{H}_0: \mu_2=\mu_4\quad \textrm{ vs. }\quad \textrm{H}_1: \mu_2\neq \mu_4.$$`
Se houver suspeitas de que a média dos tratamentos 1 e 2 não diferem da média dos tratamentos 3 e 4, temos as hipóteses:
`$$\textrm{H}_0: \mu_1+\mu_2=\mu_3+\mu_4\quad \textrm{ vs. }\quad \textrm{H}_1: \mu_1+\mu_2\neq \mu_3+\mu_4.$$`





---
class: animated, fadeIn
##Testes de hipóteses usando contrastes

Temos duas formas básicas

--

  - Teste t;
  - Teste F.


Primeiro, devemos escrever o contraste de interesse em termos das médias dos tratamentos:
`$$C=\sum_{i=1}^a c_i\overline{y}_{i\cdot}$$`

A variância do contraste é dada por
`$$\text{var}(C)=\sum_{i=1}^a \text{var}(c_i\overline{y}_{i\cdot})=\sum_{i=1}^a c_i^2\text{var}(\overline{y}_{i\cdot})=\frac{\sigma^2}{n}\sum_{i=1}^a c_i^2.$$`

---
class: animated, fadeIn
##Testes de hipóteses usando contrastes - Teste t
  
  Dado que não conhecemos a variância do erro, usamos seu estimador. Daí
  `$$\widehat{\text{var}}(C)=\frac{QME}{n}\sum_{i=1}^a c_i^2$$`
  portanto, a estatística de teste é dada por
  `$$t_0=\frac{\sum_{i=1}^a c_i\overline{y}_{i\cdot}}{\sqrt{\frac{QME}{n}\sum_{i=1}^a c_i^2}} \sim t_{(N-a)}.$$`

  Rejeita-se a hipótese nula se `\(|t_0|&gt;t_{\alpha/2,N-a}\)`.



---
class: animated, fadeIn
##Testes de hipóteses usando contrastes - Teste F
  
  Pode-se mostrar que 
  
  
  `$$t_0^2=F_0=\frac{(\sum_{i=1}^a c_i\overline{y}_{i\cdot})^2}{\frac{QME}{n}\sum_{i=1}^a c_i^2} \sim F_{(\alpha, 1, N-a)}.$$`

  Rejeita-se a hipótese nula se `\(F_0&gt;F_{(\alpha,1,N-a)}\)`.
  

---
class: animated, fadeIn
##Contrastes Ortogonais

Dois contrastes com coeficientes `\(c_i\)` e `\(d_i\)` s\~ao ortogonais se
`$$\sum_{i=1}^a c_id_i=0.$$`

Para `\(a\)` tratamentos, o conjunto de `\(a-1\)` contrastes ortogonais particiona a soma dos quadrados dos tratamentos em `\(a-1\)` componentes com um grau de liberdade cada. Deste modo, os testes feitos usando contrastes ortogonais são independentes.

--

  &gt; **Observações:**
  &gt; * Há várias formas de escolher os coeficientes dos contrastes ortogonais. Usualmente algo na natureza do experimento irá sugerir quais as comparações de interesse;
  
  &gt; * Em geral, o método de contrastes é útil quando temos comparações pré-planejadas, isto é, contrastes especificados antes de fazer o experimento e analisar os dados.

---
class: animated, fadeIn
##Contrastes Ortogonais - Exemplo I

Considere o experimento dos suplementos para vacas. Os contrastes ortogonais apropriados poderiam ser:

|Tratamento       | `\(C_1\)`|| `\(C_2\)` || `\(C_3\)`|
|:----------------|:----:||:-----:||:----:|
|  Sem Suplemento |  3   ||  0    ||  0   |
|  Mandioca       | -1   || -1    ||  1   | 
|  Araruta        | -1   ||  2    ||  0   | 
|  Batata doce    | -1   || -1    || -1   | 

--

  * O contraste `\(C_1\)` compara o efeito médio dos tratamentos com suplemento e sem suplemento. 
  
  * No contraste `\(C_2\)` são comparados os efeitos médios da Araruta com a Mandioca e Batata Doce. 
  
  * O contraste `\(C_3\)`  compara o efeito médio da Mandioca e da Batata Doce.
  
--

  &gt;**Observação:** Os coeficientes dos contrastes devem ser escolhidos antes de executar o experimento e examinar os dados. A razão para isto é que, se as comparações são selecionadas após examinar os dados, muitos pesquisadores construiriam testes que corresponderiam a grandes diferenças observadas na média.

---
class: animated, fadeIn
##Contrastes Ortogonais - Exemplo II

Assumindo que as hipóteses de pesquisa foram elaboradas antes da realização do experimento temos:

&lt;div class="math"&gt;
\[\begin{align*}
C_1&amp;=3\mu_1-(\mu_2+\mu_3+\mu_4)\\
C_2&amp;=2\mu_3-(\mu_2+\mu_4)\\
C_3&amp;= \mu_2-\mu_4\\
\end{align*}
\]
&lt;/div&gt;

--

Uma estimativa para qualquer desses contrastes é obtida substituindo-se as médias por suas estimativas, dadas por `\(\overline{y}_{i}\)`, temos por exemplo

`$$\widehat{C}_1=3\overline{y}_{1}-(\overline{y}_{2}+\overline{y}_{3}+\overline{y}_{4}).$$`

---
class: animated, fadeIn
##Contrastes Ortogonais - Exemplo III

A variância do contraste é dada por

&lt;div class="math"&gt;
\[\begin{align*}
\text{var}(\widehat{C}_1)&amp;=9\text{var}(\overline{y}_{1})+\text{var}(\overline{y}_{2})+\text{var}(\overline{y}_{3})+\text{var}(\overline{y}_{4})\\
&amp;=9\frac{\sigma_1^2}{n}+\frac{\sigma_2^2}{n}+\frac{\sigma_3^2}{n}+\frac{\sigma_4^2}{n}.
\end{align*}
\]
&lt;/div&gt;

Assumindo homoscedasticidade, temos que
`$$\widehat{\text{var}}(\widehat{C}_1)=12\times \frac{\text{QME}}{n}$$`

Dessa forma.
`$$t_0=\frac{−12,6033}{\sqrt{12\times \frac{3,53}{6}}}=-4,74.$$`
    


---
class: animated, fadeIn
##Contrastes Ortogonais - ANOVA

Para qualquer contraste temos:

&lt;div class="math"&gt;
\[\begin{align*}
 F_0&amp;=\frac{(\sum_{i=1}^a c_i\overline{y}_{i\cdot})^2}{\frac{QME}{n}\sum_{i=1}^a c_i^2}\\
    &amp;=\frac{\frac{n}{\sum_{i=1}^a c_i^2}(\sum_{i=1}^a c_i\overline{y}_{i\cdot})^2}{QME}\\
    &amp;=\frac{\frac{(\sum_{i=1}^a c_i y_{i\cdot})^2}{n\sum_{i=1}^n c_i^2}}{QME}\\
    &amp;=\frac{SQC_i}{\frac{SQE}{N-a}}.
\end{align*}
\]
&lt;/div&gt;

---
class: animated, fadeIn
##Contrastes Ortogonais - ANOVA Exemplo

A análise dos contrastes ortogonais por meio da ANOVA é conhecido como &lt;span style="color:orange"&gt;**Desdobramento dos graus de liberdade dos Tratamentos**&lt;/span&gt; ou &lt;span style="color:orange"&gt;**Partição das Somas de Quadrados dos Tratamentos**&lt;/span&gt;.

No caso do exemplo aqui analisado, temos

&lt;div class="math"&gt;
\[\begin{align*}
    SQC_1&amp;=\frac{(3\times 135,85 -139,75 - 206,39 - 137,03)^2}{6\times [3² +(-1)^2 + (-1)^2 + (-1)^2]}\\
    &amp;=79,42.\\
    SQC_2&amp;=\frac{(3\times 206,39 -139,75 - 137,03)^2}{6\times [2² +(-1)^2 + (-1)^2]}\\
    &amp;=513,77.\\
    SQC_3&amp;=\frac{(139,75 - 137,03)^2}{6\times [(-1)^2 + (-1)^2]}\\
    &amp;=0,6165.
\end{align*}
\]
&lt;/div&gt;


---
class: animated, fadeIn
##Teste de Scheffé - Comparação sem conhecimento a priori

O erro Tipo I é, no máximo, `\(\alpha\)` para qualquer uma das possíveis comparações.

**Estatística de Teste**

`$$F_{0j}=\left(\frac{C_j-E(C_j)}{\sqrt{(a-1)\widehat{\text{var}}(C_j)}}\right)^2=\frac{(\sum_{i=1}^a c_i \overline{y}_{i\cdot})^2}{(a-1)\frac{QME}{n}\sum_{i=1}^a c_i^2}\sim F_{\alpha,a-1,N-a}.$$`

--

**Margem de erro do Teste**
`$$E_j=\sqrt{(a-1)F_{\alpha,a-1,N-a}\frac{QME}{n}\sum_{i=1}^a c_i^2}.$$`

Se `\(F_{0j}&gt;F_{\alpha,a-1,N-a}\)` ou `\(|C_j|&gt;E_j\)` rejeita-se a hipótese `\(H_0: \sum_{i=1}^a c_i\mu_i=0\)`.

--
 
  &gt;**Observação:** Pode ser usado para construir intervalos de confiança simultâneos, `\(C_j-E_j&lt;\Gamma_j&lt;C_j+E_j\)`, em que a confiança simultânea de todos os intervalos é, no mínimo, `\(1-\alpha\)`.

---
class: animated, fadeIn
##Teste de Scheffé - Exemplo


```r
ScheffeTest(fit)
```

```
## 
##   Posthoc multiple comparisons of means: Scheffe Test 
##     95% family-wise confidence level
## 
## $Suplemento
##            diff     lwr.ci    upr.ci    pval    
## B-A -11.5600000 -14.868364 -8.251636 2.0e-08 ***
## M-A -11.1066667 -14.415031 -7.798302 3.8e-08 ***
## S-A -11.7566667 -15.065031 -8.448302 1.5e-08 ***
## M-B   0.4533333  -2.855031  3.761698  0.9811    
## S-B  -0.1966667  -3.505031  3.111698  0.9984    
## S-M  -0.6500000  -3.958364  2.658364  0.9475    
## 
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
```

---
class: animated, fadeIn
##Teste de Bonferroni

Para um erro experimental de `\(\alpha\)`, Bonferroni recomenda usar `\(\alpha/g\)` como nível de significância para cada teste.

**Estatística de Teste**

`$$b_{cal}=\frac{|\overline{y}_{i}-\overline{y}_{j}|}{\sqrt{QME\left(\frac{1}{n_{i}}+\frac{1}{n_{j}}\right)}}\sim t_{\left(\frac{\alpha}{2g},N-a\right)}.$$`

Rejeita-se `\(H_0\)`, se
`$$|\overline{y}_{i}-\overline{y}_{j}|\geq t_{\left(\frac{\alpha}{2g},N-a\right)}\sqrt{QME\left(\frac{1}{n_i}+\frac{1}{n_j}\right)}.$$`

--

  &gt;**Observações**
  
  &gt; * Adequado para comparações pré-planejadas, sendo pequeno o número de comparações planejadas.
  
  &gt; * Não é útil quando o número de comparações é grande.

---
class: animated, fadeIn
##Teste de Bonferroni - Exemplo



```r
pair&lt;-dados%&gt;%
  pairwise_t_test(Producao~Suplemento, pool.sd=FALSE, p.adjust.method="bonferroni")
pair
```

```
## # A tibble: 6 x 10
##   .y.    group1 group2    n1    n2 statistic    df        p   p.adj p.adj.signif
## * &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt;  &lt;int&gt; &lt;int&gt;     &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;       
## 1 Produ… A      B          6     6     9.87   6.71  3.07e-5 1.84e-4 ***         
## 2 Produ… A      M          6     6    15.9    9.76  2.67e-8 1.6 e-7 ****        
## 3 Produ… A      S          6     6    12.3    7.71  2.38e-6 1.43e-5 ****        
## 4 Produ… B      M          6     6    -0.377  7.29  7.17e-1 1   e+0 ns          
## 5 Produ… B      S          6     6     0.144  9.41  8.89e-1 1   e+0 ns          
## 6 Produ… M      S          6     6     0.656  8.47  5.29e-1 1   e+0 ns
```

---
class: animated, fadeIn
##Teste de Tukey

**Estatística de Teste**

`$$q_{cal}=\frac{\overline{y}_{max}-\overline{y}_{min}}{\sqrt{\frac{QME}{2}\left(\frac{1}{n_{max}}+\frac{1}{n_{min}}\right)}}\sim q_{a,N-a}.$$`

Quando `\(n_1=\ldots=n_a=n\)` rejeita-se `\(H_0\)`, se
`$$|\overline{y}_{i\cdot}-\overline{y}_{j\cdot}|\geq q_{\alpha,a,N-a}\sqrt{\frac{QME}{n}}.$$`

--

  &gt;**Observação:**
  &gt; * O nível de significância do teste é exatamente `\(\alpha\)` quando o número de réplicas é igual em todos os tratamentos, caso contrário é, no máximo, `\(\alpha\)`.

---
class: animated, fadeIn
###Teste de Tukey - Exemplo I


```r
tukey.test &lt;- TukeyHSD(fit)
tukey.test
```

```
##   Tukey multiple comparisons of means
##     95% family-wise confidence level
## 
## Fit: aov(formula = Producao ~ Suplemento, data = dados)
## 
## $Suplemento
##            diff        lwr       upr     p adj
## B-A -11.5600000 -14.597229 -8.522771 0.0000000
## M-A -11.1066667 -14.143896 -8.069438 0.0000000
## S-A -11.7566667 -14.793896 -8.719438 0.0000000
## M-B   0.4533333  -2.583896  3.490562 0.9747902
## S-B  -0.1966667  -3.233896  2.840562 0.9978139
## S-M  -0.6500000  -3.687229  2.387229 0.9311689
```

---
class: animated, fadeIn
###Teste de Tukey - Exemplo II


```r
plot(tukey.test)
```

&lt;img src="Exp_um_fator_ANOVA_files/figure-html/unnamed-chunk-10-1.png" width="40%" style="display: block; margin: auto;" /&gt;

---
class: animated, fadeIn
##Teste de Dunnet - Comparação dos tratamentos com um controle

**Estatística de Teste**

`$$d_{cal}=\frac{\overline{y}_{i\cdot}-\overline{y}_{c}}{\sqrt{QME\left(\frac{1}{n_{i}}+\frac{1}{n_{c}}\right)}}\sim d_{a-1,N-a}.$$`

Quando `\(n_1=\ldots=n_a=n\)` rejeita-se `\(H_0\)`, se

`$$|\overline{y}_{i\cdot}-\overline{y}_{c}|\geq d_{\alpha,a-1,N-a}\sqrt{\frac{2\times QME}{n}}.$$`

---
class: animated, fadeIn
##Teste de Dunnet - Exemplo


```r
with(dados,pairw.anova(y=Producao,x=Suplemento,control="S",method="dunnett"))##Dunnett
```

```
## 
## 95% Dunnett confidence intervals 
## 
##              Diff     Lower     Upper  Decision
## muA-muS 11.755522  8.999992 14.511051 Reject H0
## muB-muS  0.195031  -2.56408  2.954142    FTR H0
## muM-muS  0.651378 -2.104921  3.407677    FTR H0
```

---
class: animated, bounceInDown
##Tamanho de Amostra

**Limitações para o número de repetições:**

  - Custos de implantação e execução do experimento
  - Disponibilidade de material experimental
  - Disponibilidade de recursos humanos
  - Facilidade de avaliação
  - Outras causas
  
--

Em geral, o número de repetições será determinado pelo fator com maior variação, ou então, pela variável mais importante para o pesquisador.


---
class: animated, fadeIn
##Tamanho de amostra: Método de Tukey

  - Este método precisa de alguma estimativa prévia da variabilidade da resposta.
  
  - Pode determinar-se a diferença mínima significativa (d) que se deseja encontrar entre os tratamentos do experimento.

O número de repetições é dado por:
$$ n=\frac{q^2\widehat{s}^2F_{(n_1,n_2;\alpha)}}{d^2},$$
--

onde
  * `\(q\)`: Amplitude total studentizada para o experimento.
  * `\(\widehat{s}:\)` Estimativa da variabilidade.
  * `\(d:\)` Diferença mínima estabelecida.
  * `\(n_1:\)` Graus de liberdade do resíduo do novo experimento.
  * `\(n_2:\)` Graus de liberdade do resíduo do experimento anterior.

--

Dado que `\(q\)` e `\(F\)` dependem do valor de `\(n\)`, a solução é obtida por aproximações sucessivas, a partir de uma tentativa inicial.

---
class: animated, fadeIn
##Tamanho de amostra: Método de Tukey - Exemplo

Seja um experimento com 5 tratamentos. De experimentos anteriores, tem-se uma estimativa do desvio padrão dos resíduos dada por `\(\widehat{s}^2=7,4Kg/\)`parcela, por exemplo, com `\(n_2=60\)`.

Deseja-se que o novo experimento detecte diferenças de produção de `\(15Kg/\)`parcela ou maiores. Um novo experimento está sendo planejado com um delineamento completamente aleatorizado. Testando 5 tratamentos com 5 repetições, inicialmente temos 4 g.l. para tratamentos e 20 g.l. para o resíduo.

Considerando `\(\alpha=0,05\)` tem-se `\(q=4,23\)` e `\(F_{(20,60;0,05)}=1,81\)`. Assim:
`$$n=\frac{(4,23)^2(7,4)^2(1,81)}{(15)^2}=8,3.$$`
Logo, o valor de `\(n\)` adequado é de **&lt;span style="color:orange"&gt;aproximadamente 9 repetições&lt;/span&gt;**.


---
class: animated, hide-logo, bounceInDown
## Curvas Características de Operação

  &gt;**Definição:** Uma curva característica de operação é um gráfico da probabilidade de erro tipo II de um teste estatístico para um tamanho amostral particular versus um parâmetro que varia no intervalo onde a hipótese nula é falsa.
  
Consideramos a probabilidade de erro tipo II do modelo de efeitos fixos para o caso de igual número de repetições em cada tratamento,
  
  &lt;div class="math"&gt;
  \[\begin{align*}
  \beta&amp;=1-\text{P}[\text{Rejeitar H}_0|\text{H}_0 \text{ falsa}]\\
        &amp;=1-\text{P}[F_0&gt;F_{(\alpha,a-1,N-a)}|\text{H}_0 \text{ falsa}]
  \end{align*}
  \]
  &lt;/div&gt;

--

Se `\(H_0\)` for falsa, `\(F_0=\frac{QMTr}{QME}\sim F_{(\alpha,a-1,N-a;\delta)}\)`. Podem ser usadas curvas características de operação que comparam a probabilidade do erro tipo II ( `\(\beta\)` ) com o parâmetro `\(\Phi\)`, onde
`$$\Phi^2=\frac{n\sum_{i=1}^a \tau_i^2}{a\sigma^2}.$$`
A quantidade  `\(\Phi^2\)` está relacionada com o parâmetro de não centralidade `\(\delta\)`. 


---
class: animated, hide-logo, bounceInDown
## Curvas Características de Operação - Exemplo I

&lt;img src="images/CCO1.png" width="70%" style="display: block; margin: auto;" /&gt;

---
class: animated, hide-logo, bounceInDown
## Curvas Características de Operação - Exemplo II

Assuma que cinco tratamentos  são comparados em um experimento completamente aleatorizado com `\(\alpha=0,01\)`. O experimentador quer saber quantas réplicas deve observar se interessa rejeitar `\(H_0\)` com probabilidade de, no mínimo, 0,90 se `\(\sum_{i=1}^5 \tau_i^2/\sigma^2=5,0\)`. Nesse caso, o parâmetro `\(\Phi^2\)` está dado por
`$$\Phi^2=\frac{n\sum_{i=1}^5 \tau_i^2}{a\sigma^2}=\frac{5,0n}{5}=n,$$`

a curva característica de operação com `\(\nu_1=a-1=4\)` e `\(\nu_2=a(n-1)=5(n-1)\)` graus de liberdade é mostrada a seguir.

---
class: animated, hide-logo, fadeIn
## Curvas Características de Operação - Exemplo III

&lt;img src="images/CCO2.png" width="70%" style="display: block; margin: auto;" /&gt;

---
class: animated, hide-logo, fadeIn
## Curvas Características de Operação - Exemplo IV

Se `\(n=4\)`, temos que `\(\Phi^2=4\)`, ou seja, `\(\Phi=2\)` e `\(\nu=5(3)=15\)` graus de liberdade do erro. Consequentemente, `\(\beta\simeq 0,38\)`. Isto é, o poder do teste é `\(1-\beta=1-0,38=0,62\)`.

--

| `\(n\)`  | `\(\Phi^2\)` || `\(\Phi\)` || `\(a(n-1)\)` || `\(\beta\)` || `\(1-\beta\)` |
|:----:|:--------:||:------:||:-------:||:-------:||:---------------:|
| 4    | 4        || 2,00   || 15      || 0,38    || 0,62|
| 5    | 5        || 2,24   || 20      || 0,18    || 0,82|
| 6    | 6        || 2,45   || 25      || 0,06    || 0,94|


---
class: animated, hide-logo, fadeIn
## Abordagens alternativas

  - Selecionar um tamanho de amostra tal que, se a diferença entre quaisquer duas médias exceder um valor especificado `\(D\)` a hipótese nula deve ser rejeitada. Deste modo, pode-se provar que o valor mínimo  de `\(\Phi\)` é dado por
`$$\Phi^2=\frac{nD^2}{2aQME}.$$`
    
- Escolher o percentual `\(P\)` para o aumento do desvio padrão de uma observação além do qual desejamos rejeitar `\(H_0\)`, ou seja
`$$\Phi=\sqrt{n[(1+0,01P)^2-1]}.$$`

---
class: animated, hide-logo, bounceInDown
## Política de proteção aos direitos autorais

&gt; &lt;span style="color:grey"&gt;O conteúdo disponível consiste em material protegido pela legislação brasileira, sendo certo que, por ser
o detentor dos direitos sobre o conteúdo disponível na plataforma, o **LECON** e o **NEAEST** detém direito
exclusivo de usar, fruir e dispor de sua obra, conforme Artigo 5&lt;sup&gt;o&lt;/sup&gt;, inciso XXVII, da Constituição Federal
e os Artigos 7&lt;sup&gt;o&lt;/sup&gt; e 28&lt;sup&gt;o&lt;/sup&gt;, da Lei 9.610/98.
A divulgação e/ou veiculação do conteúdo em sites diferentes à plataforma e sem a devida autorização do
**LECON** e o **NEAEST**, pode configurar violação de direito autoral, nos termos da Lei 9.610/98, inclusive podendo
caracterizar conduta criminosa, conforme Artigo 184&lt;sup&gt;o&lt;/sup&gt;, §1&lt;sup&gt;o&lt;/sup&gt; a 3&lt;sup&gt;o&lt;/sup&gt;, do Código Penal.
É considerada como contrafação a reprodução não autorizada, integral ou parcial, de todo e qualquer
conteúdo disponível na plataforma.&lt;/span&gt;

.pull-left[
&lt;img src="images/logo_lecon.png" width="50%" style="display: block; margin: auto;" /&gt;
]
.pull-right[
&lt;img src="images/logo_neaest.png" width="50%" style="display: block; margin: auto;" /&gt;
]
&lt;br&gt;&lt;/br&gt;
.center[
[https://lecon.ufes.br](https://lecon.ufes.br/) &amp;emsp; &amp;emsp;  &amp;emsp; &amp;emsp; [https://analytics.ufes.br](https://analytics.ufes.br)
]

&lt;font size="2"&gt;&lt;span style="color:grey"&gt;Material elaborado pela equipe LECON/NEAEST: 
Alessandro J. Q. Sarnaglia, Bartolomeu Zamprogno, Fabio A. Fajardo, Luciana G. de Godoi 
e Nátaly A. Jiménez.&lt;/span&gt;&lt;/font&gt;
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"ratio": "16:9",
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>
<style>
.logo {
  background-image: url(images/logo_neaest.png);
  background-size: contain;
  background-repeat: no-repeat;
  position: absolute;
  top: 1em;
  right: 1em;
  width: 150px;
  height: 168px;
  z-index: 0;
}
</style>

<script>
document
  .querySelectorAll(
    '.remark-slide-content' +
    ':not(.title-slide)' +
    // add additional classes to exclude here, e.g.
    // ':not(.inverse)' +
    ':not(.hide-logo)'
  )
  .forEach(el => {
    el.innerHTML += '<div class="logo"></div>';
  });
</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
